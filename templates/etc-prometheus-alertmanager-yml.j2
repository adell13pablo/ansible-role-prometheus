# Prometheus Alertmanager configuration
# See https://prometheus.io/docs/alerting/configuration/ for alternatives

global:
{% if prometheus_alertmanager_slack_webhook %}
  slack_api_url: https://hooks.slack.com/services/{{ prometheus_alertmanager_slack_webhook }}
{% endif %}

# https://github.com/prometheus/alertmanager#example
route:

  group_wait: {{ prometheus_alert_group_wait }}
  group_interval: {{ prometheus_alert_group_interval }}
  repeat_interval: {{ prometheus_alert_repeat_interval }}

# https://www.robustperception.io/using-slack-with-the-alertmanager/

  group_by: [cluster]
  # If an alert isn't caught by a route, send it slack.
  receiver: slack-notify
  routes:
  # Send severity=slack alerts to slack.
    - match:
        severity: slack
      receiver: slack-notify


receivers:

  - name: slack-notify

{% if prometheus_alertmanager_slack_webhook and prometheus_alertmanager_slack_channel %}
    slack_configs:
      - send_resolved: true
        channel: "{{ prometheus_alertmanager_slack_channel }}"
{% endif %}
